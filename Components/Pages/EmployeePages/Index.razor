@page "/employees"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using HRMS.Models
@using HRMS.Data
@implements IAsyncDisposable
@inject IDbContextFactory<HRMS.Data.ApplicationDbContext> DbFactory

<PageTitle>员工管理</PageTitle>

<h1>员工管理</h1>

<QuickGrid Class="table" Items="context.Users.Include(u => u.Department).Include(u => u.Level)">
    <PropertyColumn Property="user => user.Name" Title="姓名" />
    <PropertyColumn Property="user => user.Gender" Title="性别" />
    <PropertyColumn Property="user => user.DateOfBirth" Title="出生日期" />
    <PropertyColumn Property="user => user.Department.DepartmentName" Title="部门" />
    <PropertyColumn Property="user => user.Level.LevelName" Title="职位" />
    <PropertyColumn Property="user => user.DateOfEntry" Title="入职日期" />
    <PropertyColumn Property="user => user.Salary" Title="薪资" />

    <TemplateColumn Context="employee">
        <a href="@($"employees/edit?id={employee.Id}")">编辑</a> |
    </TemplateColumn>
</QuickGrid>

@code{
    private ApplicationDbContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}